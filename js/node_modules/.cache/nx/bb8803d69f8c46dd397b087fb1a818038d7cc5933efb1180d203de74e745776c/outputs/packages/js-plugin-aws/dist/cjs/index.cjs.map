{"version":3,"file":"index.cjs","sources":["../../src/AwsStorageDriver.ts","../../src/plugin.ts"],"sourcesContent":["import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport {\n  MetaplexFile,\n  StorageDriver,\n  lamports,\n  Amount,\n} from '@metaplex-foundation/js';\n\nexport class AwsStorageDriver implements StorageDriver {\n  protected client: S3Client;\n  protected bucketName: string;\n\n  constructor(client: S3Client, bucketName: string) {\n    this.client = client;\n    this.bucketName = bucketName;\n  }\n\n  async getUploadPrice(_bytes: number): Promise<Amount> {\n    return lamports(0);\n  }\n\n  async upload(file: MetaplexFile): Promise<string> {\n    const command = new PutObjectCommand({\n      Bucket: this.bucketName,\n      Key: file.uniqueName,\n      Body: file.buffer,\n      ContentType: file.contentType || undefined,\n    });\n\n    try {\n      await this.client.send(command);\n\n      return await this.getUrl(file.uniqueName);\n    } catch (err) {\n      // TODO: Custom errors.\n      throw err;\n    }\n  }\n\n  async getUrl(key: string) {\n    const region = await this.client.config.region();\n    const encodedKey = encodeURIComponent(key);\n\n    return `https://s3.${region}.amazonaws.com/${this.bucketName}/${encodedKey}`;\n  }\n}\n","import type { S3Client } from '@aws-sdk/client-s3';\nimport type { Metaplex, MetaplexPlugin } from '@metaplex-foundation/js';\nimport { AwsStorageDriver } from './AwsStorageDriver';\n\nexport const awsStorage = (\n  client: S3Client,\n  bucketName: string\n): MetaplexPlugin => ({\n  install(metaplex: Metaplex) {\n    metaplex.storage().setDriver(new AwsStorageDriver(client, bucketName));\n  },\n});\n"],"names":["AwsStorageDriver","constructor","client","bucketName","getUploadPrice","_bytes","lamports","upload","file","command","PutObjectCommand","Bucket","Key","uniqueName","Body","buffer","ContentType","contentType","undefined","send","getUrl","err","key","region","config","encodedKey","encodeURIComponent","awsStorage","install","metaplex","storage","setDriver"],"mappings":";;;;;;;AAQO,MAAMA,gBAAN,CAAgD;AAIrDC,EAAAA,WAAW,CAACC,MAAD,EAAmBC,UAAnB,EAAuC;IAChD,IAAKD,CAAAA,MAAL,GAAcA,MAAd,CAAA;IACA,IAAKC,CAAAA,UAAL,GAAkBA,UAAlB,CAAA;AACD,GAAA;;EAEmB,MAAdC,cAAc,CAACC,MAAD,EAAkC;IACpD,OAAOC,WAAQ,CAAC,CAAD,CAAf,CAAA;AACD,GAAA;;EAEW,MAANC,MAAM,CAACC,IAAD,EAAsC;AAChD,IAAA,MAAMC,OAAO,GAAG,IAAIC,yBAAJ,CAAqB;MACnCC,MAAM,EAAE,KAAKR,UADsB;MAEnCS,GAAG,EAAEJ,IAAI,CAACK,UAFyB;MAGnCC,IAAI,EAAEN,IAAI,CAACO,MAHwB;AAInCC,MAAAA,WAAW,EAAER,IAAI,CAACS,WAAL,IAAoBC,SAAAA;AAJE,KAArB,CAAhB,CAAA;;IAOA,IAAI;AACF,MAAA,MAAM,KAAKhB,MAAL,CAAYiB,IAAZ,CAAiBV,OAAjB,CAAN,CAAA;AAEA,MAAA,OAAO,MAAM,IAAKW,CAAAA,MAAL,CAAYZ,IAAI,CAACK,UAAjB,CAAb,CAAA;KAHF,CAIE,OAAOQ,GAAP,EAAY;AACZ;AACA,MAAA,MAAMA,GAAN,CAAA;AACD,KAAA;AACF,GAAA;;EAEW,MAAND,MAAM,CAACE,GAAD,EAAc;IACxB,MAAMC,MAAM,GAAG,MAAM,IAAA,CAAKrB,MAAL,CAAYsB,MAAZ,CAAmBD,MAAnB,EAArB,CAAA;AACA,IAAA,MAAME,UAAU,GAAGC,kBAAkB,CAACJ,GAAD,CAArC,CAAA;AAEA,IAAA,OAAQ,cAAaC,MAAO,CAAA,eAAA,EAAiB,KAAKpB,UAAW,CAAA,CAAA,EAAGsB,UAAW,CAA3E,CAAA,CAAA;AACD,GAAA;;AApCoD;;MCJ1CE,UAAU,GAAG,CACxBzB,MADwB,EAExBC,UAFwB,MAGJ;EACpByB,OAAO,CAACC,QAAD,EAAqB;IAC1BA,QAAQ,CAACC,OAAT,EAAA,CAAmBC,SAAnB,CAA6B,IAAI/B,gBAAJ,CAAqBE,MAArB,EAA6BC,UAA7B,CAA7B,CAAA,CAAA;AACD,GAAA;;AAHmB,CAHI;;;;;"}